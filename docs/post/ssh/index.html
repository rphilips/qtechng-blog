<!DOCTYPE html>
<html lang="nl-nl">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>SSH | QtechNG Blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.69.0-DEV" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/qtechng-blog/dist/css/app.1cb140d8ba31d5b2f1114537dd04802a.css" rel="stylesheet">
    

    

    
      
    

    
    
    <meta property="og:title" content="SSH" />
<meta property="og:description" content="Waarom gebruik je SSH in qtechng?
Wel, toen we in 1997 begonnen aan de bouw van Brocade, was dit niet zo!
We hadden daarvoor 2 redenen: een goede en een slechte.
Laten we beginnen met de slechte reden. Zoals steeds, als ik gegrepen ben door een idee, dan heb ik de neiging om dat idee tot in het extreme te volgen. In 1997, 1998 was ik er van overtuigd dat web technologie de wereld van informatiebeheerders ging bepalen." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rphilips.github.io/qtechng-blog/post/ssh/" />
<meta property="article:published_time" content="2020-05-26T08:09:15+02:00" />
<meta property="article:modified_time" content="2020-05-26T08:09:15+02:00" />
<meta itemprop="name" content="SSH">
<meta itemprop="description" content="Waarom gebruik je SSH in qtechng?
Wel, toen we in 1997 begonnen aan de bouw van Brocade, was dit niet zo!
We hadden daarvoor 2 redenen: een goede en een slechte.
Laten we beginnen met de slechte reden. Zoals steeds, als ik gegrepen ben door een idee, dan heb ik de neiging om dat idee tot in het extreme te volgen. In 1997, 1998 was ik er van overtuigd dat web technologie de wereld van informatiebeheerders ging bepalen.">
<meta itemprop="datePublished" content="2020-05-26T08:09:15&#43;02:00" />
<meta itemprop="dateModified" content="2020-05-26T08:09:15&#43;02:00" />
<meta itemprop="wordCount" content="985">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SSH"/>
<meta name="twitter:description" content="Waarom gebruik je SSH in qtechng?
Wel, toen we in 1997 begonnen aan de bouw van Brocade, was dit niet zo!
We hadden daarvoor 2 redenen: een goede en een slechte.
Laten we beginnen met de slechte reden. Zoals steeds, als ik gegrepen ben door een idee, dan heb ik de neiging om dat idee tot in het extreme te volgen. In 1997, 1998 was ik er van overtuigd dat web technologie de wereld van informatiebeheerders ging bepalen."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  
  
  <header class="cover bg-top" style="background-image: url('https://rphilips.github.io/qtechng-blog/images/ssh.svg');">
    <div class="pb3-m pb6-l bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://rphilips.github.io/qtechng-blog/" class="f3 fw2 hover-white no-underline white-90 dib">
      QtechNG Blog
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/qtechng-blog/post/" title="Artikelen page">
              Artikelen
            </a>
          </li>
          
        </ul>
      
      














    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <h1 class="f2 f1-l fw2 white-90 mb0 lh-title">SSH</h1>
          
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        ARTIKELEN
      </aside>
      


      <h1 class="f1 athelas mt3 mb1">SSH</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2020-05-26T08:09:15&#43;02:00">May 26, 2020</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Waarom gebruik je <a href="https://en.wikipedia.org/wiki/Secure_Shell" title="SSH">SSH</a> in <code>qtechng</code>?</p>
<p>Wel, toen we in 1997 begonnen aan de bouw van Brocade, was dit niet zo!</p>
<p>We hadden daarvoor 2 redenen: een goede en een slechte.</p>
<p>Laten we beginnen met de slechte reden. Zoals steeds, als ik gegrepen ben door een idee, dan heb ik de neiging om dat idee tot in het extreme te volgen. In 1997, 1998 was ik er van overtuigd dat web technologie de wereld van informatiebeheerders ging bepalen. Ik wou daarom alle onze instrumenten web gebaseerd maken. Ik zag duidelijk de voordelen: geen gesukkel meer met firewalls, het vergaren van diepe kennis omtrent web technologie en ja, ook het marketing aspect daarvan (Brocade: het Web en niet sdan het Web).</p>
<p>Ik experimenteerde met shells in de webbrowser (en geprogrammeerd in Java!). Voor beveiligde communicatie was er dan <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security" title="TLS en SSL">TLS en zijn voorganger SSL</a>. En dat allemaal in <a href="https://en.wikipedia.org/wiki/Netscape_Communicator" title="Netscape Communicator">Netscape Communicator 4.71</a>.</p>
<p>Het is echter een veeg teken als je meer met de instrumenten bezig bent dan met datgene wat die instrumenten moeten bouwen. Gelukkig was er Wim Holemans die me wees op <code>SSH</code>. Dat viel samen met het moment waarop een kwalitatief hoogstaande cliënt voor Windows beschikbaar kwam: <a href="https://en.wikipedia.org/wiki/PuTTY" title="PuTTY">PuTTY</a>.</p>
<p>In de jaren daarna heb ik steeds gezocht naar een SSH library voor Python. Deze bestaat wel degelijk. <a href="https://en.wikipedia.org/wiki/Conch_(SSH)" title="Conch">Conch</a> is een onderdeel van <a href="https://en.wikipedia.org/wiki/Twisted_(software)" title="Twisted">Twisted</a> en dat is precies één van de problemen. Twisted is een omvangrijke platform dat bovendien niet echt aansloot bij de standaard manier van ontwikkelen voor Python. Conch was té moeilijk te integreren.</p>
<p>Met <code>Go</code> is de situatie helemaal anders: de SSH library wordt onderhouden door het Go-team (hoewel het nog geen echt onderdeel is van de standaard packages: er zijn nog geregeld kleine aanpassingen aan de functionaliteit). Dat is begrijpelijk: SSH is cruciaal van belang voor <a href="https://en.wikipedia.org/wiki/Docker_(software)" title="Docker">Docker</a> en <a href="https://en.wikipedia.org/wiki/Kubernetes" title="Kubernetes">Kubernetes</a>.</p>
<p>In <code>qtech</code> wordt de taak van SSH uitbesteed aan CLI&rsquo;s zoals <code>pscp.exe</code>. <code>plink.exe</code>, <code>ssh</code>, <code>scp</code>. Per <code>qtech</code> invocatie worden er telkens 2 externe executables opgestart wat de performantie zeker niet ten goede komt. De verschillen tussen <a href="https://en.wikipedia.org/wiki/OpenSSH" title="OpenSSH">OpenSSH</a> en <code>PuTTY</code> veroorzaken heel wat configuratieproblemen en communicatie tussen de verschillende onderdelen gebeurt dan over het filesysteem met als gevolg bestanden die moeten worden opgeruimd en meer van dat fraais.</p>
<p>In <code>qtech</code> (en ook in <code>qtechng</code> zijn er essentieel 3 communicatievormen die plaatsvinden over <code>SSH</code>:</p>
<ul>
<li>
<p>Een opdracht, geformuleerd op de cliënt (werkstation of productiemachine), wordt ingepakt in een Python pickle, getransfereerd naar de ontwikkelmachine. Daar wordt het antwoord ook ingepakt en teruggestuurd naar de cliënt. Een typische voorbeeld is een zoekactie naar files: <code>qtech -list edit '*.m' find='m4_getCatIsbdTitles'</code>. Deze kan typisch worden uitgevoerd door een <code>SSH</code> instructie.</p>
</li>
<li>
<p>Deze opdracht heeft betrekking op bestanden op de lokale computer. Deze moeten samen met de opdracht verstuurd worden naar de ontwikkelmachine en daar worden verwerkt. Dit kan heel wat moeilijker worden ingebed in een <code>SSH</code> instructie. In <code>qtech</code> worden de bestanden ingepakt in een ZIP-bestand en getransfereerd. Daarna wordt de opdracht verstuurd, het ZIP-bestand wordt uitgepakt en de opdracht wordt uitgevoerd. Een typsich voorbeeld is de checkin van bestanden: <code>qtech -ci *.*</code></p>
</li>
<li>
<p>Een opdracht heeft betrekking op bestanden reeds aanwezig op de ontwikkelmachine en vraagt om deze bestanden naar de lokale machine over te hevelen. Een goed voorbeeld is: <code>qtech -sync</code>.</p>
</li>
</ul>
<p>In <code>qtech</code> en <code>qtechng</code> is er sprake van 2 machines: 1 daarvan is steeds de ontwikkelmachine <code>dev.anet.be</code>, de andere is ofwel een workstation, ofwel een productiemachine.</p>
<p>Het is belangrijk om zich te realiseren dat de ontwikkelmachine, <code>dev.anet.be</code>, ook moet fungeren als werkstation én productiemachine. Als we de bovenstaande <code>qtech</code> operaties uitvoeren, dan mag het communicatie gedeelte geen overhead genereren. Ideaal voor het ontwikkelen van <code>qtechng</code> zou zijn dat gans dit proces wordt weggemoffeld.</p>
<p>De <code>Go</code> library <code>golang.org/x/crypto/ssh</code>, samen met Cobra, maakt dit mogelijk.</p>
<p>Een ander aspect aan het communicatiegebeuren is natuurlijk de serializering van de diverse concpeten: bestanden, opdrachten.</p>
<p>Er zijn 2 wegen die we kunnen opgaan:</p>
<ul>
<li>Gestandaardiseerde serializering: de data wordt ingepakt in bijvoorbeeld <a href="https://en.wikipedia.org/wiki/JSON" title="JSON">JSON</a> of <a href="https://en.wikipedia.org/wiki/Protocol_Buffers" title="Protocol Buffers">Protocol Buffers</a>.</li>
<li>Een specifieke oplossing wordt uitgewerkt.</li>
</ul>
<p>Ik heb eerst de eerste benadering uitgewerkt. De overhead voor binaire bestanden maakte <code>JSON</code> geen goede kandidaat. <code>JSON</code> wordt in <code>qtechng</code> wel degelijk veelvuldig gebruikt maar dan als datastructuur voor opslag op schijf.
Hoewel <code>Protocol Buffers</code> een excellente oplossing is, heb ik het toch niet weerhouden: immers in het communicatieproces zijn de beiden einden in dezelfde taal (<code>Go</code>). Hadden we 2 verschillende technologien gehad dan waren <code>Protocol Buffers</code> de juiste weg.</p>
<p>Uiteindelijk heb ik geopteerd voor <code>encoding/gob</code>, het elegante en performante serializeringsprotocol ingebouwd in <code>Go</code>.</p>
<p>Ik geef nu een voorbeeld van hoe gebruik te maken van <code>Cobra</code> en <code>SSH in Go</code>:</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#dc322f;font-weight:bold">package</span> <span style="color:#268bd2">cmd</span>

<span style="color:#dc322f;font-weight:bold">import</span> (
    <span style="color:#2aa198">&#34;encoding/hex&#34;</span>
    <span style="color:#2aa198">&#34;os&#34;</span>

    <span style="color:#268bd2">qresult</span> <span style="color:#2aa198">&#34;brocade.be/qtechng/result&#34;</span>
    <span style="color:#2aa198">&#34;github.com/spf13/cobra&#34;</span>
)

<span style="color:#859900">var</span> <span style="color:#268bd2">aboutCmd</span> = &amp;<span style="color:#268bd2">cobra</span>.<span style="color:#268bd2">Command</span>{
    <span style="color:#268bd2">Use</span>: <span style="color:#2aa198">&#34;about&#34;</span>,
    <span style="color:#268bd2">Short</span>: <span style="color:#2aa198">&#34;Useful information about `Qq`&#34;</span>,
    <span style="color:#268bd2">Long</span>: <span style="color:#2aa198">`Version and builttime information about Qq`</span>,
    <span style="color:#268bd2">Args</span>: <span style="color:#268bd2">cobra</span>.<span style="color:#268bd2">ArbitraryArgs</span>,
    <span style="color:#268bd2">Example</span>: <span style="color:#2aa198">&#34;Qq about&#34;</span>,
    <span style="color:#268bd2">RunE</span>: <span style="color:#268bd2">about</span>,
    <span style="color:#268bd2">PreRun</span>: <span style="color:#859900">func</span>(<span style="color:#268bd2">cmd</span> *<span style="color:#268bd2">cobra</span>.<span style="color:#268bd2">Command</span>, <span style="color:#268bd2">args</span> []<span style="color:#859900;font-weight:bold">string</span>) { <span style="color:#268bd2">preSSH</span>(<span style="color:#268bd2">cmd</span>) },
    <span style="color:#268bd2">Annotations</span>: <span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#859900;font-weight:bold">string</span>{
       <span style="color:#2aa198">&#34;remote-allowed&#34;</span>: <span style="color:#2aa198">&#34;yes&#34;</span>,
    },
}

<span style="color:#859900">func</span> <span style="color:#268bd2">init</span>() {
    <span style="color:#268bd2">rootCmd</span>.<span style="color:#268bd2">AddCommand</span>(<span style="color:#268bd2">aboutCmd</span>)
}

<span style="color:#859900">func</span> <span style="color:#268bd2">about</span>(<span style="color:#268bd2">cmd</span> *<span style="color:#268bd2">cobra</span>.<span style="color:#268bd2">Command</span>, <span style="color:#268bd2">args</span> []<span style="color:#859900;font-weight:bold">string</span>) <span style="color:#859900;font-weight:bold">error</span> {
    <span style="color:#268bd2">msg</span> := <span style="color:#859900">map</span>[<span style="color:#859900;font-weight:bold">string</span>]<span style="color:#859900;font-weight:bold">string</span>{<span style="color:#2aa198">&#34;!BuildTime&#34;</span>: <span style="color:#268bd2">BuildTime</span>, <span style="color:#2aa198">&#34;!BuildHost&#34;</span>: <span style="color:#268bd2">BuildHost</span>, <span style="color:#2aa198">&#34;!BuildWith&#34;</span>: <span style="color:#268bd2">GoVersion</span>}
    <span style="color:#268bd2">host</span>, <span style="color:#268bd2">e</span> := <span style="color:#268bd2">os</span>.<span style="color:#268bd2">Hostname</span>()
    <span style="color:#859900">if</span> <span style="color:#268bd2">e</span> == <span style="color:#859900;font-weight:bold">nil</span> {
        <span style="color:#268bd2">msg</span>[<span style="color:#2aa198">&#34;!!uname&#34;</span>] = <span style="color:#268bd2">host</span>
    }
    <span style="color:#859900">if</span> <span style="color:#cb4b16">len</span>(<span style="color:#268bd2">args</span>) != <span style="color:#2aa198;font-weight:bold">0</span> {
    <span style="color:#859900">for</span> <span style="color:#268bd2">_</span>, <span style="color:#268bd2">arg</span> := <span style="color:#859900">range</span> <span style="color:#268bd2">args</span> {
        <span style="color:#268bd2">msg</span>[<span style="color:#2aa198">&#34;hexified &#34;</span>+<span style="color:#268bd2">arg</span>] = <span style="color:#268bd2">hex</span>.<span style="color:#268bd2">EncodeToString</span>([]<span style="color:#cb4b16">byte</span>(<span style="color:#268bd2">arg</span>))
    }
    }
    <span style="color:#268bd2">Fmsg</span> = <span style="color:#268bd2">qresult</span>.<span style="color:#268bd2">ShowResult</span>(<span style="color:#268bd2">qresult</span>.<span style="color:#268bd2">RMAnswer</span>(<span style="color:#268bd2">msg</span>))
    <span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">nil</span>
}
</code></pre></div><p>Je kan de code op 2 manieren activeren: (<code>Qq</code> is de voorlopige naam voor <code>qtechng</code>)</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Qq about
</code></pre></div><p>en:</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Qq about --remote
</code></pre></div><p>In het eerste geval vertelt de software je iets over de versie van <code>Qq</code> op je werkstation:</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">(base) ~/tmp$ Qq about
{
    <span style="color:#2aa198">&#34;host&#34;</span>: <span style="color:#2aa198">&#34;rphilips-home&#34;</span>,
    <span style="color:#2aa198">&#34;time&#34;</span>: <span style="color:#2aa198">&#34;2020-05-26T10:05:48+02:00&#34;</span>,
    <span style="color:#2aa198">&#34;RESULT&#34;</span>: {
        <span style="color:#2aa198">&#34;!!uname&#34;</span>: <span style="color:#2aa198">&#34;rphilips-home&#34;</span>,
        <span style="color:#2aa198">&#34;!BuildHost&#34;</span>: <span style="color:#2aa198">&#34;rphilips-home&#34;</span>,
        <span style="color:#2aa198">&#34;!BuildTime&#34;</span>: <span style="color:#2aa198">&#34;2020.05.24-11:30:43&#34;</span>,
        <span style="color:#2aa198">&#34;!BuildWith&#34;</span>: <span style="color:#2aa198">&#34;go1.14.3&#34;</span>
    }
}
(base) ~/tmp$
</code></pre></div><p>In het tweede geval krijg je informatie over de ontwikkelmachine:</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">(base) ~/tmp$ Qq about --remote
{
    <span style="color:#2aa198">&#34;host&#34;</span>: <span style="color:#2aa198">&#34;rphilips-VirtualBox&#34;</span>,
    <span style="color:#2aa198">&#34;time&#34;</span>: <span style="color:#2aa198">&#34;2020-05-26T10:07:13+02:00&#34;</span>,
    <span style="color:#2aa198">&#34;RESULT&#34;</span>: {
        <span style="color:#2aa198">&#34;!!uname&#34;</span>: <span style="color:#2aa198">&#34;rphilips-VirtualBox&#34;</span>,
        <span style="color:#2aa198">&#34;!BuildHost&#34;</span>: <span style="color:#2aa198">&#34;rphilips-home&#34;</span>,
        <span style="color:#2aa198">&#34;!BuildTime&#34;</span>: <span style="color:#2aa198">&#34;2020.05.15-15:36:53&#34;</span>,
        <span style="color:#2aa198">&#34;!BuildWith&#34;</span>: <span style="color:#2aa198">&#34;go1.14.2&#34;</span>
    }
}
(base) ~/tmp$
</code></pre></div><p>Bij de ontwikkeling van <code>func about</code> is het communicatiegedeelte (over SSH) onzichtbaar: je ontwikkelt voor het gemakkelijkste geval waarbij er gewoonweg geen communicatie is!</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://rphilips.github.io/qtechng-blog/" >
    &copy;  QtechNG Blog 2020 
  </a>
    <div>













</div>
  </div>
</footer>

    

  <script src="/qtechng-blog/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
